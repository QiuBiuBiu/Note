# 进程调度/页面置换/磁盘调度算法

## 进程调度算法
进程调度算法也称 CPU 调度算法，毕竟进程是由 CPU 调度的。
1. 非抢占式：
    1. 先来先服务调度算法
    2. 时间片轮转调度算法
        - 如果时间片设得太短会导致过多的进程上下文切换，降低了 CPU 效率；
        - 如果设得太长又可能引起对短作业进程的响应时间变长。
        - 通常时间片设为 20ms~50ms 通常是一个比较合理的折中值。
2. 抢占式：
    1. 最短作业优先调度算法
    2. 高响应比优先调度算法 (优先级=（等待时间+要求服务时间)/要求服务时间)
        - 如果两个进程的「等待时间」相同时，「要求的服务时间」越短，「响应比」就越高，这样短作业的进程容易被选中运行；
        - 如果两个进程「要求的服务时间」相同时，「等待时间」越长，「响应比」就越高，这就兼顾到了长作业进程。
    3. 最高优先级调度算法
        - 非抢占式：当就绪队列中出现优先级高的进程，运行完当前进程，再选择优先级高的进程。
        - 抢占式：当就绪队列中出现优先级高的进程，当前进程挂起，调度优先级高的进程运行。
    4. 多级反馈队列调度算法
        - 设置了多个队列，赋予每个队列不同的优先级，每个队列优先级从高到低，同时优先级越高时间片越短；
        - 新的进程会被放入到第一级队列的末尾，按先来先服务的原则排队等待被调度，如果在第一级队列规定的时间片没运行完成，则将其转入到第二级队列的末尾，以此类推，直至完成；
        - 当较高优先级的队列为空，才调度较低优先级的队列中的进程运行。如果进程运行时，有新进程进入较高优先级的队列，则停止当前运行的进程并将其移入到原队列末尾，接着让较高优先级的进程运行；

## 内存页面置换算法
### 缺页中断 
在了解内存页面置换算法前，我们得先谈一下缺页异常（缺页中断）。当 CPU 访问的页面不在物理内存时，便会产生一个缺页中断，请求操作系统将所缺页调入到物理内存。那它与一般中断的主要区别在于：
- 缺页中断在指令执行「期间」产生和处理中断信号，而一般中断在一条指令执行「完成」后检查和处理中断信号。
- 缺页中断返回到该指令的开始重新执行「该指令」，而一般中断返回回到该指令的「下一个指令」执行。

### 页表项
页表项通常有如下图的字段：
1. 状态位：用于表示该页是否有效，也就是说是否在物理内存中，供程序访问时参考。
2. 访问字段：用于记录该页在一段时间被访问的次数，供页面置换算法选择出页面时参考。
3. 修改位：表示该页在调入内存后是否有被修改过，由于内存中的每一页都在磁盘上保留一份副本，因此，如果没有修改，在置换该页时就不需要将该页写回到磁盘上，以减少系统的开销；如果已经被修改，则将该页重写到磁盘上，以保证磁盘中所保留的始终是最新的副本。
4. 硬盘地址：用于指出该页在硬盘上的地址，通常是物理块号，供调入该页时使用。

### 内存页面置换算法
1. 最佳页面置换算法（OPT）（理想算法）
    - 最佳页面置换算法作用是为了衡量你的算法的效率，你的算法效率越接近该算法的效率，那么说明你的算法是高效的。
2. 先进先出置换算法（FIFO）
3. 最近最久未使用的置换算法（LRU）
    - 选择最长时间没有被访问的页面进行置换。（可用双链表+哈希表的数据结构来实现）
4. 时钟页面置换算法（Lock）
    - 把所有的页面都保存在一个类似钟面的「环形链表」中，一个表针指向最老的页面。
    - 当发生缺页中断时，算法首先检查表针指向的页面：
        - 如果它的访问位位是 0 就淘汰该页面，并把新的页面插入这个位置，然后把表针前移一个位置；
        - 如果访问位是 1 就清除访问位，并把表针前移一个位置，重复这个过程直到找到了一个访问位为 0 的页面为止；
5. 最不常用置换算法（LFU）
    - 当发生缺页中断时，选择「访问次数」最少的那个页面，并将其淘汰。


## 磁盘调度算法
1. 先来先服务算法
2. 最短寻道时间优先算法
    - 优先选择从当前磁头位置所需寻道时间最短的请求。
    - 可能会产生饥饿现象，这里产生饥饿的原因是磁头在一小块区域来回移动。
3. 扫描算法（电梯算法）
    - 扫描调度算法性能较好，不会产生饥饿现象，但是存在这样的问题，中间部分的磁道会比较占便宜，中间部分相比其他部分响应的频率会比较多，也就是说每个磁道的响应频率存在差异。
4. 循环扫描算法
    - 扫描算法使得每个磁道响应的频率存在差异，那么要优化这个问题的话，可以总是按相同的方向进行扫描，使得每个磁道的响应频率基本一致。
    - 循环扫描（Circular Scan, CSCAN ）规定：只有磁头朝某个特定方向移动时，才处理磁道访问请求，而返回时直接快速移动至最靠边缘的磁道，也就是复位磁头，这个过程是很快的，并且返回中途不处理任何请求，该算法的特点，就是磁道只响应一个方向上的请求。
5. LOOK 与 C-LOOK 算法
    - 扫描算法和循环扫描算法，都是磁头移动到磁盘「最始端或最末端」才开始调换方向。
    - 那这其实是可以优化的，优化的思路就是磁头在移动到「最远的请求」位置，然后立即反向移动。

